# backend/Dockerfile
FROM node:20-alpine

# Instalar dependencias del sistema
RUN apk add --no-cache openssl

# Crear directorio de trabajo
WORKDIR /app

# Copiar archivos de dependencias
COPY package*.json ./
COPY prisma ./prisma/

# Instalar dependencias (incluyendo devDependencies para Prisma)
RUN npm install

# Generar cliente de Prisma
RUN npx prisma generate

# Limpiar node_modules y reinstalar solo production
RUN rm -rf node_modules && npm install --only=production

# Copiar c√≥digo compilado
COPY dist ./dist

# Crear directorio para uploads
RUN mkdir -p uploads

# Exponer puerto
EXPOSE 3001

# Comando de inicio
CMD ["node", "dist/main.js"]